<div class="h-24"></div>

<h2 class="form-title">Add Patient Consultation</h2>

<form [formGroup]="patientForm" (ngSubmit)="onSubmit()" class="patient-form">

  <section class="form-section">
    <h3>üìû Contact Information</h3>
    <div class="form-row">
      <div class="form-group">
        <label>Email</label>
        <input formControlName="email" type="email" placeholder="example@mail.com" />
        <div class="error-message" *ngIf="patientForm.get('email')?.invalid && patientForm.get('email')?.touched">
          Invalid email.
        </div>
      </div>
      <div class="form-group">
        <label>Phone*</label>
        <input formControlName="phone" type="tel" placeholder="0712345678" />
        <div class="error-message" *ngIf="patientForm.get('phone')?.invalid && patientForm.get('phone')?.touched">
          Invalid or missing phone number.
        </div>
      </div>
    </div>
  </section>

  <section class="form-section">
    <h3>üßç Personal Information</h3>
    <div class="form-row">
      <div class="form-group">
        <label>First Name*</label>
        <input formControlName="firstName" type="text" />
        <div class="error-message" *ngIf="patientForm.get('firstName')?.invalid && patientForm.get('firstName')?.touched">
          First name is required.
        </div>
      </div>
      <div class="form-group">
        <label>Last Name*</label>
        <input formControlName="lastName" type="text" />
        <div class="error-message" *ngIf="patientForm.get('lastName')?.invalid && patientForm.get('lastName')?.touched">
          Last name is required.
        </div>
      </div>
      <div class="form-group">
        <label>CNP*</label>
        <input formControlName="cnp" type="text" placeholder="1234567890123" />
        <div class="error-message" *ngIf="patientForm.get('cnp')?.invalid && patientForm.get('cnp')?.touched">
          Invalid CNP.
        </div>
      </div>
      <div class="form-group">
        <label>Age</label>
        <input [value]="age" disabled />
      </div>
      <div class="form-group">
        <label>Sex</label>
        <input [value]="sex" disabled />
      </div>
      <div class="form-group">
        <label>Date of Birth</label>
        <input type="date" formControlName="birthDate" />
      </div>
      <div class="form-group">
        <label>Occupation*</label>
        <input formControlName="occupation" type="text" />
        <div class="error-message" *ngIf="patientForm.get('occupation')?.invalid && patientForm.get('occupation')?.touched">
          Required field.
        </div>
      </div>
    </div>
  </section>

  <section class="form-section">
    <h3>üè† Address</h3>
    <div class="form-row">
      <div class="form-group">
        <label>City*</label>
        <input formControlName="locality" type="text" />
        <div class="error-message" *ngIf="patientForm.get('locality')?.touched && patientForm.get('locality')?.invalid">
          <div *ngIf="patientForm.get('locality')?.errors?.['required']">City is required.</div>
        </div>
      </div>

      <div class="form-group">
        <label>Street*</label>
        <input formControlName="street" type="text" />
        <div class="error-message" *ngIf="patientForm.get('street')?.touched && patientForm.get('street')?.invalid">
          <div *ngIf="patientForm.get('street')?.errors?.['required']">Street is required.</div>
        </div>
      </div>

      <div class="form-group">
        <label>No*</label>
        <input formControlName="number" type="text" />
        <div class="error-message" *ngIf="patientForm.get('number')?.touched && patientForm.get('number')?.invalid">
          <div *ngIf="patientForm.get('number')?.errors?.['required']">Number is required.</div>
          <div *ngIf="patientForm.get('number')?.errors?.['pattern']">Number must contain only digits.</div>
        </div>
      </div>

      <div class="form-group"><label>Block</label><input formControlName="block" type="text" /></div>
      <div class="form-group"><label>Staircase</label><input formControlName="staircase" type="text" /></div>
      <div class="form-group"><label>Apartment</label><input formControlName="apartment" type="text" /></div>
      <div class="form-group"><label>Floor</label><input formControlName="floor" type="text" /></div>
    </div>
  </section>

  <section class="form-section">
    <h3>ü©∫ Medical Information</h3>
    <div class="form-row">

      <div class="form-group">
        <label>Blood Group*</label>
        <select formControlName="bloodGroup">
          <option value="">Select</option>
          <option value="A">A</option>
          <option value="B">B</option>
          <option value="O">O</option>
          <option value="AB">AB</option>
        </select>
        <div class="error-message" *ngIf="patientForm.get('bloodGroup')?.touched && patientForm.get('bloodGroup')?.invalid">
          Blood group is required.
        </div>
      </div>

      <div class="form-group">
        <label>Rh Factor*</label>
        <select formControlName="rh">
          <option value="">Select</option>
          <option value="+">Positive</option>
          <option value="-">Negative</option>
        </select>
        <div class="error-message" *ngIf="patientForm.get('rh')?.touched && patientForm.get('rh')?.invalid">
          Rh factor is required.
        </div>
      </div>

      <div class="form-group">
        <label>Weight (kg)*</label>
        <input formControlName="weight" type="text" />
        <div class="error-message" *ngIf="patientForm.get('weight')?.touched && patientForm.get('weight')?.invalid">
          <div *ngIf="patientForm.get('weight')?.errors?.['required']">Weight is required.</div>
          <div *ngIf="patientForm.get('weight')?.errors?.['pattern']">Weight must be a valid number (e.g. 70 or 70.5).</div>
        </div>
      </div>

      <div class="form-group">
        <label>Height (cm)*</label>
        <input formControlName="height" type="text" />
        <div class="error-message" *ngIf="patientForm.get('height')?.touched && patientForm.get('height')?.invalid">
          <div *ngIf="patientForm.get('height')?.errors?.['required']">Height is required.</div>
          <div *ngIf="patientForm.get('height')?.errors?.['pattern']">Height must be a valid number (e.g. 170 or 170.5).</div>
        </div>
      </div>

      <div class="form-group">
        <label>Allergies</label>
        <input formControlName="allergies" type="text" />
      </div>

    </div>
  </section>

  <section class="form-section">
    <h3>üßæ Diagnoses</h3>
    <div formArrayName="diseases">
      <div
        *ngFor="let diseaseCtrl of diseases.controls; let i = index"
        [formGroupName]="i"
        class="diagnosis-card"
      >
        <div class="diagnosis-grid">
          <div class="form-group">
            <label>Diagnosis</label>
            <app-diagnosis-code
              (diseaseSelected)="onDiseaseSelected(i, $event)">
            </app-diagnosis-code>
          </div>

          <div class="form-group">
            <label>ICD Code</label>
            <input
              type="text"
              [value]="diseaseCtrl.get('icdCode')?.value || ''"
              readonly
            />
          </div>

          <div class="form-group">
            <label>Category</label>
            <select formControlName="category">
              <option value="">Select</option>
              <option value="Chronic">Chronic</option>
              <option value="Genetic">Genetic</option>
              <option value="Acute">Acute</option>
              <option value="Autoimmune">Autoimmune</option>
            </select>
          </div>

          <div class="form-group full-width">
            <label>Description</label>
            <textarea
              formControlName="description"
              placeholder="e.g. Short notes about the condition...">
          </textarea>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="form-actions">
    <button type="submit" [disabled]="patientForm.invalid">üíæ Save Patient</button>
  </div>

</form>
